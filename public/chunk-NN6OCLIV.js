import{a as P}from"./chunk-BPA3JQGJ.js";import{a as T}from"./chunk-B7IK2G5Z.js";import"./chunk-3J7GGTVR.js";import"./chunk-RAVDJK6K.js";import{$ as p,Ba as x,Bb as M,D as a,Db as _,E as s,G as u,Gb as O,J as h,O as m,P as o,Q as c,R as v,Ua as E,X as f,aa as I,ba as R,fa as d,ga as C,ra as w,rb as b,sb as S,ta as y}from"./chunk-IK5HEOFA.js";import"./chunk-EML4Z42K.js";import"./chunk-QJCI42UW.js";import"./chunk-AHB567SM.js";import"./chunk-ZGHBVQKU.js";import"./chunk-YSN7XVTD.js";import"./chunk-R5HL6L5F.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-2YSZFPCQ.js";import"./chunk-57YRIO75.js";import"./chunk-SE6TZ7MM.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{e as l}from"./chunk-JHI3MBHO.js";var V=["videoElement"];function B(i,n){if(i&1&&(o(0,"div",5)(1,"div",6),d(2),c()()),i&2){let j=f();a(2),C(j.counter)}}function k(i,n){i&1&&(o(0,"div",7),v(1,"video",8,0),o(3,"div",9),v(4,"ion-icon",10),o(5,"div",11),d(6,"Recording..."),c()()())}var ne=(()=>{let n=class n{constructor(t,e,r){this.videoService=t,this.storageService=e,this.router=r,this.counter=5,this.isRecording=!1,this.mediaRecorder=null,this.recordedChunks=[],this.currentVideoName=""}ngOnInit(){}ngAfterViewInit(){this.startCountdown()}startCountdown(){this.countdownInterval=setInterval(()=>{this.counter--,this.counter<=0&&(clearInterval(this.countdownInterval),setTimeout(()=>this.startRecording(),100))},1e3)}startRecording(){return l(this,null,function*(){try{if(this.isRecording=!0,yield new Promise(e=>setTimeout(e,50)),!this.videoElement)throw new Error("Video element not found");let t=yield navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}},audio:!1});this.videoElement.nativeElement.srcObject=t,this.mediaRecorder=new MediaRecorder(t,{mimeType:"video/webm"}),this.mediaRecorder.ondataavailable=e=>{e.data.size>0&&this.recordedChunks.push(e.data)},this.mediaRecorder.onstop=()=>l(this,null,function*(){let e=new Blob(this.recordedChunks,{type:"video/webm"});console.log("videoBlob: ",e),yield this.videoService.storeVideo(e),this.router.navigate(["videos-list"])}),this.mediaRecorder.start(100),setTimeout(()=>this.stopRecording(),15e3)}catch(t){console.error("Error starting recording:",t),this.isRecording=!1}})}stopRecording(){this.mediaRecorder&&this.mediaRecorder.state!=="inactive"&&this.mediaRecorder.stop(),this.videoElement?.nativeElement?.srcObject&&(this.videoElement.nativeElement.srcObject.getTracks().forEach(e=>e.stop()),this.videoElement.nativeElement.srcObject=null),this.isRecording=!1}ngOnDestroy(){clearInterval(this.countdownInterval),this.stopRecording()}};n.\u0275fac=function(e){return new(e||n)(s(T),s(P),s(x))},n.\u0275cmp=u({type:n,selectors:[["app-regresive-counter"]],viewQuery:function(e,r){if(e&1&&p(V,5),e&2){let g;I(g=R())&&(r.videoElement=g.first)}},decls:7,vars:2,consts:[["videoElement",""],["color","primary"],[1,"ion-padding"],["class","counter-container",4,"ngIf"],["class","recording-container",4,"ngIf"],[1,"counter-container"],[1,"counter"],[1,"recording-container"],["autoplay","","playsinline","",1,"video-preview"],[1,"recording-indicator"],["name","videocam",1,"recording-icon"],[1,"recording-text"]],template:function(e,r){e&1&&(o(0,"ion-header")(1,"ion-toolbar",1)(2,"ion-title"),d(3,"Video Recorder"),c()()(),o(4,"ion-content",2),h(5,B,3,1,"div",3)(6,k,7,0,"div",4),c()),e&2&&(a(5),m("ngIf",!r.isRecording),a(),m("ngIf",r.isRecording))},dependencies:[S,y,w,_,M,b,O,E],styles:[".counter-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:80vh}.counter[_ngcontent-%COMP%]{font-size:10rem;font-weight:700;color:var(--ion-color-primary)}.recording-container[_ngcontent-%COMP%]{position:relative;height:80vh;display:flex;flex-direction:column;justify-content:center;align-items:center}.video-preview[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.recording-indicator[_ngcontent-%COMP%]{position:absolute;top:20px;left:20px;display:flex;align-items:center;background:#ff000080;padding:8px 12px;border-radius:20px;color:#fff}.recording-icon[_ngcontent-%COMP%]{margin-right:8px;font-size:1.2rem}.recording-text[_ngcontent-%COMP%]{font-size:1rem}"]});let i=n;return i})();export{ne as RegresiveCounterPage};
